<!DOCTYPE HTML>
<html lang="en">


<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta name="keywords" content="7-Marketing Email campaign, Naixin&#39;s blog">
    <meta name="baidu-site-verification" content>
    <meta name="google-site-verification" content>
    <meta name="360-site-verification" content>
    <meta name="description" content="Background:
This notebook aims to optimize the marketing campaigns.
Specifically, we will achieve:
    - What percentage">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>7-Marketing Email campaign | Naixin&#39;s blog</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">
    <style type="text/css">
        
    </style>

    <script src="/libs/jquery/jquery-2.2.0.min.js"></script>
    <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
    <script>
        var _hmt = _hmt || [];
        (function () {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?46e79e71af0709a5b9106bf20cecc493";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

<body>

    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Naixin's blog</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fa fa-navicon"></i></a>
<ul class="right">
    
    <li class="hide-on-med-and-down">
        <a href="/" class="waves-effect waves-light">
            
            <span>Home</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/categories" class="waves-effect waves-light">
            
            <span>Learning notes</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/about" class="waves-effect waves-light">
            
            <span>About</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/friends" class="waves-effect waves-light">
            
            <span>Courses</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/contact" class="waves-effect waves-light">
            
            <span>Contact</span>
        </a>
    </li>
    
    <li>
        <a href="#searchModal" class="modal-trigger waves-effect waves-light">
            <i id="searchIcon" class="fa fa-search" title="Search"></i>
        </a>
    </li>
</ul>

<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Naixin's blog</div>
        <div class="logo-desc">
            
            You never lose, you either win or learn.
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li>
            <a href="/" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-link"></i>
                
                Home
            </a>
        </li>
        
        <li>
            <a href="/categories" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-link"></i>
                
                Learning notes
            </a>
        </li>
        
        <li>
            <a href="/about" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-link"></i>
                
                About
            </a>
        </li>
        
        <li>
            <a href="/friends" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-link"></i>
                
                Courses
            </a>
        </li>
        
        <li>
            <a href="/contact" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-link"></i>
                
                Contact
            </a>
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/naixinzhang" class="waves-effect waves-light" target="_blank">
                <i class="fa fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>

        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/naixinzhang" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    
<script src="/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/24.jpg')">
    <div class="container">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <div class="description center-align post-title">
                        7-Marketing Email campaign
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 20px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                        <a href="/tags/Python-Take-home-challenge/" target="_blank">
                            <span class="chip bg-color">Python_Take home challenge</span>
                        </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fa fa-bookmark fa-fw icon-category"></i>
                        
                        <a href="/categories/Take-home-data-challenge/" class="post-category" target="_blank">
                            Take home data challenge
                        </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                <div class="post-date info-break-policy">
                    <i class="fa fa-calendar-minus-o fa-fw"></i>Publish Date:&nbsp;&nbsp;
                    2018-02-01
                </div>

                <div class="post-author info-break-policy">
                    <i class="fa fa-user-o fa-fw"></i>Author:&nbsp;&nbsp;
                    
                    Naixin Zhang
                    
                </div>

                
                
                <div class="info-break-policy">
                    <i class="fa fa-file-word-o fa-fw"></i>Word Count:&nbsp;&nbsp;
                    4.5k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="fa fa-clock-o fa-fw"></i>Read Times:&nbsp;&nbsp;
                    28 Min
                </div>
                
                

                
                <div id="busuanzi_container_page_pv" class="info-break-policy">
                    <i class="fa fa-eye fa-fw"></i>Read Count:&nbsp;&nbsp;
                    <span id="busuanzi_value_page_pv"></span>
                </div>
                
            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <p>Background:
This notebook aims to optimize the marketing campaigns.
Specifically, we will achieve:
    - What percentage of users opened the email?
    - what percentage clicked on the link within the email?
    - build a model to optimize in future email campaigns to maximize the probability of users who click on the link/total users who received the email.
      How would you test that
    - find interesting pattern on how the email campaign performed for different segments of users.</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> itertools
<span class="token keyword">import</span> _pickle <span class="token keyword">as</span> cPickle
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
plt<span class="token punctuation">.</span>style<span class="token punctuation">.</span>use<span class="token punctuation">(</span><span class="token string">"ggplot"</span><span class="token punctuation">)</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>feature_selection <span class="token keyword">import</span> chi2<span class="token punctuation">,</span>f_classif
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> LabelEncoder
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> classification_report<span class="token punctuation">,</span>roc_curve<span class="token punctuation">,</span>precision_score<span class="token punctuation">,</span>recall_score<span class="token punctuation">,</span>auc<span class="token punctuation">,</span>precision_recall_curve
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split
<span class="token keyword">import</span> xgboost <span class="token keyword">as</span> xgb<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python">seed <span class="token operator">=</span> <span class="token number">9999</span>
plt<span class="token punctuation">.</span>style<span class="token punctuation">.</span>use<span class="token punctuation">(</span><span class="token string">'ggplot'</span><span class="token punctuation">)</span>
<span class="token operator">%</span>matplotlib inline<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h2 id="Index"><a href="#Index" class="headerlink" title="Index"></a>Index</h2><ul>
<li><a href="#Load-emails-information-from-CSV-file">Load emails from CSV</a></li>
<li><a href="#Answer-question-1">Answer Question 1</a></li>
<li><a href="#Explore-the-data">Explore the data</a><ul>
<li><a href="#Chi-square-test-and-F-test">Chi-square test and F-test</a></li>
<li><a href="#previous-purchase-vs.-response">previous purchase history vs. response</a></li>
<li><a href="#user's-country-vs.-response">user’s country vs. response</a></li>
<li><a href="#email's-version-vs.-response">email’s version vs. response</a></li>
<li><a href="#weekday-vs.-response">weekday vs. reponse</a></li>
<li><a href="#email-text-vs.-response">email text vs. response</a></li>
<li><a href="#sending-hour-vs.-response">sending hour vs. response</a></li>
</ul>
</li>
<li><a href="#Answer-question-4">Answer Question 4</a></li>
<li><a href="#Build-Predictive-Model">Build Predictive Model</a><ul>
<li><a href="#Prepare-the-data">Prepare the data</a></li>
<li><a href="#Train-the-model">Train the model</a></li>
<li><a href="#Plot-ROC-curve-and-choose-better-probability-threshold">Plot ROC curve and choose better probability threshold</a></li>
</ul>
</li>
<li><a href="#Answer-question-2-and-question-3's-first-part">Answer question 2 and question 3’s first part</a></li>
<li><a href="#Answer-question-3's-second-part">Answer question 3’s second part</a></li>
<li>Answers summary:<ul>
<li><a href="#Answer-question-1">Answer Question 1</a></li>
<li><a href="#Answer-question-2-and-question-3's-first-part">Answer question 2 and question 3’s first part</a></li>
<li><a href="#Answer-question-3's-second-part">Answer question 3’s second part</a></li>
<li><a href="#Answer-question-4">Answer Question 4</a></li>
</ul>
</li>
</ul>
<h2 id="Load-emails-information-from-CSV-file"><a href="#Load-emails-information-from-CSV-file" class="headerlink" title="Load emails information from CSV file"></a>Load emails information from CSV file</h2><pre class="line-numbers language-python"><code class="language-python">emails <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">"email_table.csv"</span><span class="token punctuation">,</span>index_col<span class="token operator">=</span><span class="token string">"email_id"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>Columns:</p>
<ul>
<li>email_id : the Id of the email that was sent. It is unique by email </li>
<li>email_text : there are two versions of the email: one has “long text” (i.e. has 4 paragraphs) and one has “short text” (just 2 paragraphs) </li>
<li>email_version : some emails were “personalized” (i.e. they had the name of the user receiving the email in the incipit, such as “Hi John,”), while some emails were “generic” (the incipit was just “Hi,”). </li>
<li>hour : the user local time when the email was sent. </li>
<li>weekday : the day when the email was sent. </li>
<li>user_country : the country where the user receiving the email was based. It comes from the user ip address when she created the account. </li>
<li>user_past_purchases : how many items in the past were bought by the user receiving the email</li>
</ul>
<pre class="line-numbers language-python"><code class="language-python">emails<span class="token punctuation">.</span>sample<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># view some data to get a feeling</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}</code></pre><p></style><p></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>email_text</th>
      <th>email_version</th>
      <th>hour</th>
      <th>weekday</th>
      <th>user_country</th>
      <th>user_past_purchases</th>
    </tr>
    <tr>
      <th>email_id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>434924</th>
      <td>long_email</td>
      <td>personalized</td>
      <td>3</td>
      <td>Tuesday</td>
      <td>US</td>
      <td>1</td>
    </tr>
    <tr>
      <th>97442</th>
      <td>long_email</td>
      <td>personalized</td>
      <td>9</td>
      <td>Thursday</td>
      <td>FR</td>
      <td>7</td>
    </tr>
    <tr>
      <th>919106</th>
      <td>short_email</td>
      <td>generic</td>
      <td>16</td>
      <td>Friday</td>
      <td>US</td>
      <td>4</td>
    </tr>
    <tr>
      <th>476265</th>
      <td>long_email</td>
      <td>generic</td>
      <td>13</td>
      <td>Saturday</td>
      <td>UK</td>
      <td>2</td>
    </tr>
    <tr>
      <th>723144</th>
      <td>long_email</td>
      <td>personalized</td>
      <td>12</td>
      <td>Monday</td>
      <td>US</td>
      <td>6</td>
    </tr>
    <tr>
      <th>518804</th>
      <td>short_email</td>
      <td>generic</td>
      <td>7</td>
      <td>Wednesday</td>
      <td>UK</td>
      <td>7</td>
    </tr>
    <tr>
      <th>801247</th>
      <td>short_email</td>
      <td>personalized</td>
      <td>6</td>
      <td>Tuesday</td>
      <td>US</td>
      <td>0</td>
    </tr>
    <tr>
      <th>946474</th>
      <td>long_email</td>
      <td>generic</td>
      <td>9</td>
      <td>Friday</td>
      <td>US</td>
      <td>18</td>
    </tr>
    <tr>
      <th>867238</th>
      <td>short_email</td>
      <td>generic</td>
      <td>3</td>
      <td>Friday</td>
      <td>UK</td>
      <td>7</td>
    </tr>
    <tr>
      <th>750202</th>
      <td>short_email</td>
      <td>generic</td>
      <td>13</td>
      <td>Sunday</td>
      <td>UK</td>
      <td>8</td>
    </tr>
  </tbody>
</table>
</div>




<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># email_text : there are two versions of the email: </span>
<span class="token comment" spellcheck="true"># one has "long text" (i.e. has 4 paragraphs) and one has "short text" (just 2 paragraphs)</span>
<span class="token comment" spellcheck="true"># since we need to change all features into numbers, so I replace 'email_text' with 'paragraphs'</span>
emails<span class="token punctuation">[</span><span class="token string">"paragraphs"</span><span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>emails<span class="token punctuation">.</span>email_text <span class="token operator">==</span> <span class="token string">'short_email'</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token keyword">del</span> emails<span class="token punctuation">[</span><span class="token string">"email_text"</span><span class="token punctuation">]</span>

<span class="token comment" spellcheck="true"># email_version : some emails were "personalized" (i.e. they had name of the user in incipit, such as "Hi John,"), </span>
<span class="token comment" spellcheck="true"># while some emails were "generic" (the incipit was just "Hi,").</span>
emails<span class="token punctuation">[</span><span class="token string">"is_personal"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>emails<span class="token punctuation">.</span>email_version <span class="token operator">==</span> <span class="token string">"personalized"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>int<span class="token punctuation">)</span>
<span class="token keyword">del</span> emails<span class="token punctuation">[</span><span class="token string">"email_version"</span><span class="token punctuation">]</span>

weekday2index <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"Monday"</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"Tuesday"</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">"Wednesday"</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"Thursday"</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token string">"Friday"</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token string">"Saturday"</span><span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token string">"Sunday"</span><span class="token punctuation">:</span><span class="token number">7</span><span class="token punctuation">}</span>
emails<span class="token punctuation">[</span><span class="token string">"weekday"</span><span class="token punctuation">]</span> <span class="token operator">=</span> emails<span class="token punctuation">.</span>weekday<span class="token punctuation">.</span>map<span class="token punctuation">(</span>weekday2index<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># rename long column names to shorter names, make it easier to read</span>
emails<span class="token punctuation">.</span>rename<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'user_past_purchases'</span><span class="token punctuation">:</span><span class="token string">'purchases'</span><span class="token punctuation">,</span><span class="token string">'user_country'</span><span class="token punctuation">:</span><span class="token string">'country'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>assemble emails’ response together</p>
<pre class="line-numbers language-python"><code class="language-python">emails<span class="token punctuation">[</span><span class="token string">"response"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"received"</span>

open_users <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">"email_opened_table.csv"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>email_id
emails<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>open_users<span class="token punctuation">,</span><span class="token string">"response"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"opened"</span>

click_users <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">"link_clicked_table.csv"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>email_id
emails<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>click_users<span class="token punctuation">,</span><span class="token string">"response"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'clicked'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python">emails<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># check some data to get a feeling</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

<pre><code>.dataframe tbody tr th {
    vertical-align: top;
}

.dataframe thead th {
    text-align: right;
}</code></pre><p></style><p></p>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>hour</th>
      <th>weekday</th>
      <th>country</th>
      <th>purchases</th>
      <th>paragraphs</th>
      <th>is_personal</th>
      <th>response</th>
    </tr>
    <tr>
      <th>email_id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>85120</th>
      <td>2</td>
      <td>7</td>
      <td>US</td>
      <td>5</td>
      <td>2</td>
      <td>1</td>
      <td>received</td>
    </tr>
    <tr>
      <th>966622</th>
      <td>12</td>
      <td>7</td>
      <td>UK</td>
      <td>2</td>
      <td>4</td>
      <td>1</td>
      <td>clicked</td>
    </tr>
    <tr>
      <th>777221</th>
      <td>11</td>
      <td>3</td>
      <td>US</td>
      <td>2</td>
      <td>4</td>
      <td>1</td>
      <td>received</td>
    </tr>
    <tr>
      <th>493711</th>
      <td>6</td>
      <td>1</td>
      <td>UK</td>
      <td>1</td>
      <td>2</td>
      <td>0</td>
      <td>received</td>
    </tr>
    <tr>
      <th>106887</th>
      <td>14</td>
      <td>1</td>
      <td>US</td>
      <td>6</td>
      <td>4</td>
      <td>0</td>
      <td>received</td>
    </tr>
  </tbody>
</table>
</div>




<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># output a csv file</span>
emails<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span><span class="token string">"clean_emails.csv"</span><span class="token punctuation">,</span>index_label<span class="token operator">=</span><span class="token string">"email_id"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h2 id="Answer-question-1"><a href="#Answer-question-1" class="headerlink" title="Answer question 1"></a>Answer question 1</h2><ul>
<li><span style="color:blue;font-weight:bold">What percentage of users opened the email?</span></li>
<li><span style="color:blue;font-weight:bold">what percentage clicked on the link within the email?</span></li>
</ul>
<pre class="line-numbers language-python"><code class="language-python">rslt_dist <span class="token operator">=</span> emails<span class="token punctuation">.</span>response<span class="token punctuation">.</span>value_counts<span class="token punctuation">(</span>normalize<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
rslt_dist<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>received    0.89605
opened      0.08276
clicked     0.02119
Name: response, dtype: float64</code></pre><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">print</span> <span class="token string">"{:.2f}% of users opened the email"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> rslt_dist<span class="token punctuation">.</span>received<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token string">"{:.2f}% of users clicked the link"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>rslt_dist<span class="token punctuation">.</span>clicked <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>10.39% of users opened the email
2.12% of users clicked the link</code></pre><h2 id="Explore-the-data"><a href="#Explore-the-data" class="headerlink" title="Explore the data"></a>Explore the data</h2><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">count_result_ratio</span><span class="token punctuation">(</span>df<span class="token punctuation">)</span><span class="token punctuation">:</span>
    counts <span class="token operator">=</span> df<span class="token punctuation">.</span>response<span class="token punctuation">.</span>value_counts<span class="token punctuation">(</span>normalize<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    counts<span class="token punctuation">[</span><span class="token string">'total'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> counts

<span class="token keyword">def</span> <span class="token function">grp_count_plotbar</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">:</span>
    grpresult <span class="token operator">=</span> emails<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">.</span>apply<span class="token punctuation">(</span>count_result_ratio<span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># grpresult.loc[:,["received","opened",'clicked']].plot(kind='bar')</span>
    grpresult<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'clicked'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>kind<span class="token operator">=</span><span class="token string">'bar'</span><span class="token punctuation">,</span>title<span class="token operator">=</span><span class="token string">'click ratio vs. {}'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'click ratio'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> grpresult<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="Chi-square-test-and-F-test"><a href="#Chi-square-test-and-F-test" class="headerlink" title="Chi-square test and F-test"></a>Chi-square test and F-test</h3><pre class="line-numbers language-python"><code class="language-python">resp_lb_encoder <span class="token operator">=</span> LabelEncoder<span class="token punctuation">(</span><span class="token punctuation">)</span>
cnty_lb_encoder <span class="token operator">=</span> LabelEncoder<span class="token punctuation">(</span><span class="token punctuation">)</span>

X <span class="token operator">=</span> emails<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
y <span class="token operator">=</span> resp_lb_encoder<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>X<span class="token punctuation">.</span>response<span class="token punctuation">)</span>
<span class="token keyword">del</span> X<span class="token punctuation">[</span><span class="token string">"response"</span><span class="token punctuation">]</span>

feat_names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"hour"</span><span class="token punctuation">,</span><span class="token string">"weekday"</span><span class="token punctuation">,</span><span class="token string">"country"</span><span class="token punctuation">,</span><span class="token string">"purchases"</span><span class="token punctuation">,</span><span class="token string">"paragraphs"</span><span class="token punctuation">,</span><span class="token string">"is_personal"</span><span class="token punctuation">]</span>
X <span class="token operator">=</span> X<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span>feat_names<span class="token punctuation">]</span>
X<span class="token punctuation">[</span><span class="token string">"country"</span><span class="token punctuation">]</span> <span class="token operator">=</span> cnty_lb_encoder<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>X<span class="token punctuation">.</span>country<span class="token punctuation">)</span>

chi2scores<span class="token punctuation">,</span>_ <span class="token operator">=</span> chi2<span class="token punctuation">(</span>X<span class="token punctuation">,</span>y<span class="token punctuation">)</span>
fscores<span class="token punctuation">,</span>_ <span class="token operator">=</span> f_classif<span class="token punctuation">(</span>X<span class="token punctuation">,</span>y<span class="token punctuation">)</span>

feat_scores <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"chi2scores"</span><span class="token punctuation">:</span>chi2scores<span class="token punctuation">,</span><span class="token string">"fscores"</span><span class="token punctuation">:</span>fscores<span class="token punctuation">}</span><span class="token punctuation">,</span>index<span class="token operator">=</span>feat_names<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python">feat_scores<span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span>by<span class="token operator">=</span><span class="token string">'chi2scores'</span><span class="token punctuation">,</span>ascending<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>chi2scores</th>
      <th>fscores</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>purchases</th>
      <td>3448.795660</td>
      <td>663.388596</td>
    </tr>
    <tr>
      <th>country</th>
      <td>378.554465</td>
      <td>435.696911</td>
    </tr>
    <tr>
      <th>is_personal</th>
      <td>316.752872</td>
      <td>317.427444</td>
    </tr>
    <tr>
      <th>weekday</th>
      <td>210.006087</td>
      <td>105.002643</td>
    </tr>
    <tr>
      <th>hour</th>
      <td>147.815921</td>
      <td>33.992047</td>
    </tr>
    <tr>
      <th>paragraphs</th>
      <td>53.952439</td>
      <td>81.209295</td>
    </tr>
  </tbody>
</table>
</div>




<pre class="line-numbers language-python"><code class="language-python">feat_scores<span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span>by<span class="token operator">=</span><span class="token string">"fscores"</span><span class="token punctuation">,</span>ascending<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>chi2scores</th>
      <th>fscores</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>purchases</th>
      <td>3448.795660</td>
      <td>663.388596</td>
    </tr>
    <tr>
      <th>country</th>
      <td>378.554465</td>
      <td>435.696911</td>
    </tr>
    <tr>
      <th>is_personal</th>
      <td>316.752872</td>
      <td>317.427444</td>
    </tr>
    <tr>
      <th>weekday</th>
      <td>210.006087</td>
      <td>105.002643</td>
    </tr>
    <tr>
      <th>paragraphs</th>
      <td>53.952439</td>
      <td>81.209295</td>
    </tr>
    <tr>
      <th>hour</th>
      <td>147.815921</td>
      <td>33.992047</td>
    </tr>
  </tbody>
</table>
</div>



<p>from the test result, we can know that,</p>
<ul>
<li>important features: <em><em> previous purchase counts, user’s country, email’s version (personal or general) </em></em></li>
<li>not so important features <strong>maybe</strong> include: <em><em> weekday, email’s text (short or long), hour to send the email </em></em></li>
</ul>
<h3 id="previous-purchase-vs-response"><a href="#previous-purchase-vs-response" class="headerlink" title="previous purchase vs. response"></a>previous purchase vs. response</h3><pre class="line-numbers language-python"><code class="language-python">rslt_grpby_purchase <span class="token operator">=</span> emails<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">"purchases"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>apply<span class="token punctuation">(</span>count_result_ratio<span class="token punctuation">)</span><span class="token punctuation">.</span>unstack<span class="token punctuation">(</span><span class="token punctuation">)</span>
rslt_grpby_purchase<span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python">plt<span class="token punctuation">.</span>rc<span class="token punctuation">(</span><span class="token string">'figure'</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
rslt_grpby_purchase<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">"received"</span><span class="token punctuation">,</span><span class="token string">"opened"</span><span class="token punctuation">,</span><span class="token string">'clicked'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>marker<span class="token operator">=</span><span class="token string">'o'</span><span class="token punctuation">,</span>markersize<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">"ratio"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre><code>&lt;matplotlib.text.Text at 0x11bb87850&gt;</code></pre><p><img src="output_25_1.png" alt="png"></p>
<p>from above plot, we can know, <span style="color:orange;font-weight:bold;font-size:1.5em">the more items a certain user purchased previously, the more likely that user will open the email or click the link.</span></p>
<h3 id="user’s-country-vs-response"><a href="#user’s-country-vs-response" class="headerlink" title="user’s country vs. response"></a>user’s country vs. response</h3><pre class="line-numbers language-python"><code class="language-python">grp_count_plotbar<span class="token punctuation">(</span><span class="token string">'country'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>response</th>
      <th>received</th>
      <th>opened</th>
      <th>clicked</th>
      <th>total</th>
    </tr>
    <tr>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>ES</th>
      <td>0.960570</td>
      <td>0.031103</td>
      <td>0.008327</td>
      <td>9967.0</td>
    </tr>
    <tr>
      <th>FR</th>
      <td>0.958779</td>
      <td>0.033217</td>
      <td>0.008004</td>
      <td>9995.0</td>
    </tr>
    <tr>
      <th>UK</th>
      <td>0.879282</td>
      <td>0.096043</td>
      <td>0.024675</td>
      <td>19939.0</td>
    </tr>
    <tr>
      <th>US</th>
      <td>0.880481</td>
      <td>0.095160</td>
      <td>0.024360</td>
      <td>60099.0</td>
    </tr>
  </tbody>
</table>
</div>




<p><img src="output_28_1.png" alt="png"></p>
<p>from above plots, we see that, ‘open percentage’ and ‘click percentage’ is much higher (nearly 3 times) in UK and US than in France and Spain. </p>
<p>this may be the <span style="color:orange;font-weight:bold;font-size:1.5em">translation issue. I guess the emails are written in English, which is unreadable to some non-English-speaking users, which cause the low ‘click ratio’ in non-English-speaking countries.</span></p>
<h3 id="email’s-version-vs-response"><a href="#email’s-version-vs-response" class="headerlink" title="email’s version vs. response"></a>email’s version vs. response</h3><pre class="line-numbers language-python"><code class="language-python">grp_count_plotbar<span class="token punctuation">(</span><span class="token string">'is_personal'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>response</th>
      <th>received</th>
      <th>opened</th>
      <th>clicked</th>
      <th>total</th>
    </tr>
    <tr>
      <th>is_personal</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.920034</td>
      <td>0.064829</td>
      <td>0.015137</td>
      <td>50209.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.871864</td>
      <td>0.100842</td>
      <td>0.027294</td>
      <td>49791.0</td>
    </tr>
  </tbody>
</table>
</div>




<p><img src="output_31_1.png" alt="png"></p>
<p><span style="color:orange;font-weight:bold;font-size:1.5em">‘personalized email’ has higher ‘click ratio’ than ‘general email’</span>. this is very easy to understand. Having my name in the recipient, at least I am some kind of ‘important’ to the company, other than some ordinary people which the company don’t bother to remember his name.</p>
<h3 id="weekday-vs-response"><a href="#weekday-vs-response" class="headerlink" title="weekday vs. response"></a>weekday vs. response</h3><pre class="line-numbers language-python"><code class="language-python">grp_count_plotbar<span class="token punctuation">(</span><span class="token string">'weekday'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>response</th>
      <th>received</th>
      <th>opened</th>
      <th>clicked</th>
      <th>total</th>
    </tr>
    <tr>
      <th>weekday</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>0.883590</td>
      <td>0.093504</td>
      <td>0.022906</td>
      <td>14363.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.879092</td>
      <td>0.096019</td>
      <td>0.024889</td>
      <td>14143.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.879296</td>
      <td>0.093084</td>
      <td>0.027620</td>
      <td>14084.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.881348</td>
      <td>0.094207</td>
      <td>0.024445</td>
      <td>14277.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.925019</td>
      <td>0.060944</td>
      <td>0.014037</td>
      <td>14177.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.912005</td>
      <td>0.070149</td>
      <td>0.017846</td>
      <td>14569.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.911448</td>
      <td>0.071801</td>
      <td>0.016751</td>
      <td>14387.0</td>
    </tr>
  </tbody>
</table>
</div>




<p><img src="output_34_1.png" alt="png"></p>
<p><span style="color:orange;font-weight:bold;font-size:1.5em">Friday, Saturday, Sunday have obviously lower ‘click ratio’ than Monday to Thursday</span>. People normally don’t process emails during weekends.</p>
<h3 id="email-text-vs-response"><a href="#email-text-vs-response" class="headerlink" title="email text vs. response"></a>email text vs. response</h3><pre class="line-numbers language-python"><code class="language-python">grp_count_plotbar<span class="token punctuation">(</span><span class="token string">'paragraphs'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>response</th>
      <th>received</th>
      <th>opened</th>
      <th>clicked</th>
      <th>total</th>
    </tr>
    <tr>
      <th>paragraphs</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>0.883698</td>
      <td>0.092430</td>
      <td>0.023872</td>
      <td>49724.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.908266</td>
      <td>0.073196</td>
      <td>0.018538</td>
      <td>50276.0</td>
    </tr>
  </tbody>
</table>
</div>




<p><img src="output_37_1.png" alt="png"></p>
<h3 id="sending-hour-vs-response"><a href="#sending-hour-vs-response" class="headerlink" title="sending hour vs. response"></a>sending hour vs. response</h3><pre class="line-numbers language-python"><code class="language-python">grp_count_plotbar<span class="token punctuation">(</span><span class="token string">'hour'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>response</th>
      <th>received</th>
      <th>opened</th>
      <th>clicked</th>
      <th>total</th>
    </tr>
    <tr>
      <th>hour</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>0.910840</td>
      <td>0.071032</td>
      <td>0.018128</td>
      <td>2703.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.911589</td>
      <td>0.072089</td>
      <td>0.016322</td>
      <td>3676.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.915184</td>
      <td>0.065293</td>
      <td>0.019523</td>
      <td>4610.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.911419</td>
      <td>0.072394</td>
      <td>0.016186</td>
      <td>5622.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.917417</td>
      <td>0.064570</td>
      <td>0.018013</td>
      <td>6551.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.909176</td>
      <td>0.073677</td>
      <td>0.017147</td>
      <td>7465.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.909434</td>
      <td>0.072282</td>
      <td>0.018284</td>
      <td>8204.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.911407</td>
      <td>0.069659</td>
      <td>0.018933</td>
      <td>8398.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.873725</td>
      <td>0.100481</td>
      <td>0.025794</td>
      <td>8529.0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0.866993</td>
      <td>0.104768</td>
      <td>0.028240</td>
      <td>8180.0</td>
    </tr>
    <tr>
      <th>11</th>
      <td>0.872645</td>
      <td>0.100227</td>
      <td>0.027128</td>
      <td>7483.0</td>
    </tr>
    <tr>
      <th>12</th>
      <td>0.875230</td>
      <td>0.099109</td>
      <td>0.025661</td>
      <td>6508.0</td>
    </tr>
    <tr>
      <th>13</th>
      <td>0.890521</td>
      <td>0.089590</td>
      <td>0.019889</td>
      <td>5581.0</td>
    </tr>
    <tr>
      <th>14</th>
      <td>0.889520</td>
      <td>0.089738</td>
      <td>0.020742</td>
      <td>4580.0</td>
    </tr>
    <tr>
      <th>15</th>
      <td>0.894074</td>
      <td>0.081019</td>
      <td>0.024907</td>
      <td>3493.0</td>
    </tr>
    <tr>
      <th>16</th>
      <td>0.894165</td>
      <td>0.082639</td>
      <td>0.023197</td>
      <td>2759.0</td>
    </tr>
    <tr>
      <th>17</th>
      <td>0.890650</td>
      <td>0.090861</td>
      <td>0.018489</td>
      <td>1893.0</td>
    </tr>
    <tr>
      <th>18</th>
      <td>0.905700</td>
      <td>0.078114</td>
      <td>0.016186</td>
      <td>1421.0</td>
    </tr>
    <tr>
      <th>19</th>
      <td>0.924862</td>
      <td>0.058564</td>
      <td>0.016575</td>
      <td>905.0</td>
    </tr>
    <tr>
      <th>20</th>
      <td>0.911585</td>
      <td>0.076220</td>
      <td>0.012195</td>
      <td>656.0</td>
    </tr>
    <tr>
      <th>21</th>
      <td>0.942466</td>
      <td>0.049315</td>
      <td>0.008219</td>
      <td>365.0</td>
    </tr>
    <tr>
      <th>22</th>
      <td>0.931373</td>
      <td>0.049020</td>
      <td>0.019608</td>
      <td>204.0</td>
    </tr>
    <tr>
      <th>23</th>
      <td>0.917241</td>
      <td>0.041379</td>
      <td>0.041379</td>
      <td>145.0</td>
    </tr>
    <tr>
      <th>24</th>
      <td>0.840580</td>
      <td>0.130435</td>
      <td>0.028986</td>
      <td>69.0</td>
    </tr>
  </tbody>
</table>
</div>




<p><img src="output_39_1.png" alt="png"></p>
<p>although from above plot, it seems ‘sending hour’ has some impact on ‘clicked ratio’. however, that may be caused by much fewer examples in late hours. also according to <a href="#Chi-square-test-and-F-test">statistical test</a>‘s result, I don’t think ‘sending hour’ is an important feature, and won’t include it in my model.</p>
<h2 id="Answer-question-4"><a href="#Answer-question-4" class="headerlink" title="Answer question 4"></a>Answer question 4</h2><p><span style="color:blue;font-weight:bold">Did you ﬁnd any interesting pattern on how the email campaign performed for diﬀerent segments of users? Explain.</span></p>
<p>from above explorary analysis, I can find some interesting patterns listed below:</p>
<ul>
<li><a href="#previous-purchase-vs.-response">The more item a certain user purchased in the past, the more likely that user will click the link</a></li>
<li><a href="#user's-country-vs.-response">Users from English-speaking coutries are more likely to click the link</a>, which may be caused by some translation issue.</li>
<li><a href="#email's-version-vs.-response">Personalized email is more likely to be opened and clicked</a></li>
<li><a href="#weekday-vs.-response">Emails sent at weekends is less likely to be opened and clicked</a></li>
<li><a href="#Chi-square-test-and-F-test">Sending hour and #Paragraphs are not very important features to affect click rate</a></li>
</ul>
<h2 id="Build-Predictive-Model"><a href="#Build-Predictive-Model" class="headerlink" title="Build Predictive Model"></a>Build Predictive Model</h2><p>In this section, I will build a model to predict whether a user will open the email and click the link inside it.</p>
<h3 id="Prepare-the-data"><a href="#Prepare-the-data" class="headerlink" title="Prepare the data"></a>Prepare the data</h3><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">del</span> X
X <span class="token operator">=</span> emails<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
X<span class="token punctuation">.</span>sample<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># get a feeling about current data</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>hour</th>
      <th>weekday</th>
      <th>country</th>
      <th>purchases</th>
      <th>paragraphs</th>
      <th>is_personal</th>
      <th>response</th>
    </tr>
    <tr>
      <th>email_id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>785135</th>
      <td>10</td>
      <td>4</td>
      <td>UK</td>
      <td>4</td>
      <td>4</td>
      <td>0</td>
      <td>received</td>
    </tr>
    <tr>
      <th>479664</th>
      <td>4</td>
      <td>5</td>
      <td>UK</td>
      <td>0</td>
      <td>4</td>
      <td>0</td>
      <td>received</td>
    </tr>
    <tr>
      <th>233005</th>
      <td>19</td>
      <td>5</td>
      <td>US</td>
      <td>10</td>
      <td>4</td>
      <td>0</td>
      <td>received</td>
    </tr>
    <tr>
      <th>285041</th>
      <td>15</td>
      <td>2</td>
      <td>US</td>
      <td>7</td>
      <td>4</td>
      <td>1</td>
      <td>received</td>
    </tr>
    <tr>
      <th>10411</th>
      <td>2</td>
      <td>5</td>
      <td>UK</td>
      <td>5</td>
      <td>4</td>
      <td>0</td>
      <td>received</td>
    </tr>
  </tbody>
</table>
</div>




<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># select original features</span>
<span class="token comment" spellcheck="true"># 'paragraphs' isn't an important feature, but I will include it, and see how RF say about it</span>
X <span class="token operator">=</span> X<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">"country"</span><span class="token punctuation">,</span><span class="token string">"purchases"</span><span class="token punctuation">,</span><span class="token string">"paragraphs"</span><span class="token punctuation">,</span><span class="token string">"is_personal"</span><span class="token punctuation">]</span> <span class="token punctuation">]</span>

<span class="token comment" spellcheck="true"># create new feature</span>
X<span class="token punctuation">[</span><span class="token string">'is_weekend'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>emails<span class="token punctuation">.</span>weekday<span class="token operator">>=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span>int<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># One-Hot-Encode 'country' feature</span>
X <span class="token operator">=</span> pd<span class="token punctuation">.</span>get_dummies<span class="token punctuation">(</span>X<span class="token punctuation">,</span>columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"country"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>drop_first<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># prepare the target</span>
y <span class="token operator">=</span> <span class="token punctuation">(</span>emails<span class="token punctuation">.</span>response <span class="token operator">==</span> <span class="token string">'clicked'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span>int<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python">X<span class="token punctuation">.</span>sample<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># check the data</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>purchases</th>
      <th>paragraphs</th>
      <th>is_personal</th>
      <th>is_weekend</th>
      <th>country_FR</th>
      <th>country_UK</th>
      <th>country_US</th>
    </tr>
    <tr>
      <th>email_id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>231912</th>
      <td>5</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>538951</th>
      <td>5</td>
      <td>2</td>
      <td>1</td>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>716309</th>
      <td>5</td>
      <td>2</td>
      <td>1</td>
      <td>0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>695780</th>
      <td>6</td>
      <td>4</td>
      <td>1</td>
      <td>1</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>586318</th>
      <td>2</td>
      <td>4</td>
      <td>1</td>
      <td>0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div>




<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># split for training and testing</span>
Xtrain<span class="token punctuation">,</span>Xtest<span class="token punctuation">,</span>ytrain<span class="token punctuation">,</span>ytest <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>X<span class="token punctuation">,</span>y<span class="token punctuation">,</span>test_size<span class="token operator">=</span><span class="token number">0.33333</span><span class="token punctuation">,</span>random_state <span class="token operator">=</span> seed<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">print</span> <span class="token string">'Train set shape: {}, positive ratio={:.3f}'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>Xtrain<span class="token punctuation">.</span>shape<span class="token punctuation">,</span>ytrain<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token string">'Test set shape: {}, positive ratio={:.3f}'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>Xtest<span class="token punctuation">.</span>shape<span class="token punctuation">,</span>ytest<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>Train set shape: (66667, 7), positive ratio=0.021
Test set shape: (33333, 7), positive ratio=0.022</code></pre><h3 id="Train-the-model"><a href="#Train-the-model" class="headerlink" title="Train the model"></a>Train the model</h3><p>Due to time limitation, I will just train one GBM model.</p>
<p><span style="color:red;font-weight:bold;font-size:1.5em">If given sufficient time, I will apply following strategies to improve the model:</span></p>
<ul>
<li><span style="color:red">build multiple models, and ensemble them (average or stacking) to improve the prediction performance.</span></li>
<li><span style="color:red">try more hyper-parameters to find better ones.</span></li>
</ul>
<pre class="line-numbers language-python"><code class="language-python">train_matrix <span class="token operator">=</span> xgb<span class="token punctuation">.</span>DMatrix<span class="token punctuation">(</span>Xtrain<span class="token punctuation">,</span>ytrain<span class="token punctuation">)</span>
test_matrix <span class="token operator">=</span> xgb<span class="token punctuation">.</span>DMatrix<span class="token punctuation">(</span>Xtest<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python">params <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
params<span class="token punctuation">[</span><span class="token string">'objective'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'binary:logistic'</span>  <span class="token comment" spellcheck="true"># output probabilities</span>
params<span class="token punctuation">[</span><span class="token string">'eval_metric'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'auc'</span>
params<span class="token punctuation">[</span><span class="token string">"num_rounds"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">300</span>
params<span class="token punctuation">[</span><span class="token string">"early_stopping_rounds"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">30</span>
<span class="token comment" spellcheck="true"># params['min_child_weight'] = 2</span>
params<span class="token punctuation">[</span><span class="token string">'max_depth'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">6</span>
params<span class="token punctuation">[</span><span class="token string">'eta'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0.1</span>
params<span class="token punctuation">[</span><span class="token string">"subsample"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0.8</span>
params<span class="token punctuation">[</span><span class="token string">"colsample_bytree"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0.8</span>

cv_results <span class="token operator">=</span> xgb<span class="token punctuation">.</span>cv<span class="token punctuation">(</span>params<span class="token punctuation">,</span>train_matrix<span class="token punctuation">,</span>
                    num_boost_round <span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token string">"num_rounds"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    nfold <span class="token operator">=</span> params<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'nfold'</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    metrics <span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token string">'eval_metric'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    early_stopping_rounds <span class="token operator">=</span> params<span class="token punctuation">[</span><span class="token string">"early_stopping_rounds"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    verbose_eval <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
                    seed <span class="token operator">=</span> seed<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>[0]    train-auc:0.677493+0.00828721    test-auc:0.672627+0.00998874
[1]    train-auc:0.697782+0.00882727    test-auc:0.696658+0.0206434
[2]    train-auc:0.70463+0.00828662    test-auc:0.702561+0.0208773
[3]    train-auc:0.711914+0.00409068    test-auc:0.710696+0.0228788
[4]    train-auc:0.714488+0.00278646    test-auc:0.712043+0.0193185
[5]    train-auc:0.717649+0.00424529    test-auc:0.714465+0.0207032
[6]    train-auc:0.719344+0.00510737    test-auc:0.715544+0.0193956
[7]    train-auc:0.724209+0.00365824    test-auc:0.719632+0.0165027
[8]    train-auc:0.729045+0.00371847    test-auc:0.72386+0.0148701
[9]    train-auc:0.730501+0.00375046    test-auc:0.724429+0.0142755
[10]    train-auc:0.732467+0.0026696    test-auc:0.726337+0.0156743
[11]    train-auc:0.735537+0.00246068    test-auc:0.729132+0.0162888
[12]    train-auc:0.737188+0.00155158    test-auc:0.730848+0.0168706
[13]    train-auc:0.738333+0.00183292    test-auc:0.73156+0.016002
[14]    train-auc:0.740307+0.00175305    test-auc:0.732328+0.0157333
[15]    train-auc:0.741514+0.00256378    test-auc:0.733169+0.0154183
[16]    train-auc:0.742537+0.0021792    test-auc:0.733099+0.0151237
[17]    train-auc:0.744702+0.00246548    test-auc:0.735111+0.0143654
[18]    train-auc:0.744979+0.00216543    test-auc:0.735508+0.0144697
[19]    train-auc:0.746026+0.00214697    test-auc:0.736038+0.0145
[20]    train-auc:0.747204+0.00234766    test-auc:0.73719+0.0144764
[21]    train-auc:0.748409+0.0027355    test-auc:0.737671+0.0133952
[22]    train-auc:0.749618+0.00291407    test-auc:0.738383+0.0132849
[23]    train-auc:0.750261+0.0030989    test-auc:0.739096+0.0125292
[24]    train-auc:0.750758+0.00331821    test-auc:0.739578+0.0117813
[25]    train-auc:0.751382+0.00282425    test-auc:0.739345+0.0120623
[26]    train-auc:0.752415+0.00346696    test-auc:0.740137+0.010798
[27]    train-auc:0.75338+0.00363762    test-auc:0.740929+0.0106986
[28]    train-auc:0.754266+0.00323947    test-auc:0.741637+0.0107274
[29]    train-auc:0.754915+0.00302772    test-auc:0.741759+0.0112564
[30]    train-auc:0.755914+0.0028627    test-auc:0.742037+0.0113041
[31]    train-auc:0.756318+0.0033501    test-auc:0.7425+0.0109369
[32]    train-auc:0.756882+0.00331093    test-auc:0.74231+0.0109721
[33]    train-auc:0.757279+0.00329185    test-auc:0.742169+0.011238
[34]    train-auc:0.757727+0.00332192    test-auc:0.74215+0.0115881
[35]    train-auc:0.758015+0.00318842    test-auc:0.742415+0.0118561
[36]    train-auc:0.75832+0.00301207    test-auc:0.742148+0.0119087
[37]    train-auc:0.758837+0.00294787    test-auc:0.742522+0.0116916
[38]    train-auc:0.759134+0.00323002    test-auc:0.742998+0.0112852
[39]    train-auc:0.759435+0.00314337    test-auc:0.743453+0.0113958
[40]    train-auc:0.759625+0.00329416    test-auc:0.743103+0.0111658
[41]    train-auc:0.760182+0.00309855    test-auc:0.743537+0.0108819
[42]    train-auc:0.760478+0.00316004    test-auc:0.743372+0.011017
[43]    train-auc:0.760531+0.00324614    test-auc:0.743372+0.0112937
[44]    train-auc:0.760811+0.00309214    test-auc:0.743344+0.0112747
[45]    train-auc:0.761199+0.00302771    test-auc:0.743541+0.0114938
[46]    train-auc:0.761436+0.00302944    test-auc:0.743817+0.0118088
[47]    train-auc:0.761543+0.00314059    test-auc:0.744085+0.0117599
[48]    train-auc:0.761755+0.00306749    test-auc:0.744454+0.0118087
[49]    train-auc:0.761926+0.00314977    test-auc:0.744501+0.0118104
[50]    train-auc:0.762055+0.00309526    test-auc:0.744369+0.0119067
[51]    train-auc:0.762271+0.00292601    test-auc:0.744522+0.0120931
[52]    train-auc:0.762409+0.00301158    test-auc:0.744722+0.0119359
[53]    train-auc:0.762461+0.00298882    test-auc:0.744397+0.0117605
[54]    train-auc:0.762592+0.00298153    test-auc:0.744378+0.0119351
[55]    train-auc:0.762895+0.00297585    test-auc:0.744472+0.0118786
[56]    train-auc:0.762913+0.00296567    test-auc:0.744442+0.0117821
[57]    train-auc:0.763132+0.00301844    test-auc:0.744228+0.0117882
[58]    train-auc:0.763194+0.0029937    test-auc:0.744274+0.0116317
[59]    train-auc:0.763377+0.00302593    test-auc:0.744082+0.011701
[60]    train-auc:0.763542+0.00298474    test-auc:0.743952+0.0117522
[61]    train-auc:0.763706+0.00296295    test-auc:0.743824+0.0117634
[62]    train-auc:0.763734+0.00293909    test-auc:0.743966+0.0115998
[63]    train-auc:0.763867+0.00296588    test-auc:0.743936+0.0116863
[64]    train-auc:0.763986+0.0029833    test-auc:0.743937+0.0116513
[65]    train-auc:0.764118+0.00302993    test-auc:0.743966+0.0117081
[66]    train-auc:0.764343+0.00292955    test-auc:0.743819+0.01163
[67]    train-auc:0.76442+0.00289046    test-auc:0.743918+0.0116983
[68]    train-auc:0.76458+0.00284802    test-auc:0.744038+0.0113129
[69]    train-auc:0.764717+0.00293263    test-auc:0.743734+0.0113893
[70]    train-auc:0.764937+0.00289321    test-auc:0.743605+0.0114114
[71]    train-auc:0.764969+0.00291843    test-auc:0.743335+0.0114451
[72]    train-auc:0.765096+0.00293488    test-auc:0.743135+0.0116176
[73]    train-auc:0.765168+0.00292989    test-auc:0.743155+0.0116143
[74]    train-auc:0.765326+0.00296368    test-auc:0.743008+0.0114881
[75]    train-auc:0.765443+0.00296921    test-auc:0.743122+0.0115193
[76]    train-auc:0.765457+0.00295559    test-auc:0.743204+0.011375
[77]    train-auc:0.765536+0.00298759    test-auc:0.74318+0.0113059
[78]    train-auc:0.765807+0.00298637    test-auc:0.74306+0.0113673
[79]    train-auc:0.765864+0.00301058    test-auc:0.743087+0.0114866
[80]    train-auc:0.765975+0.00306381    test-auc:0.743178+0.011708
[81]    train-auc:0.766011+0.00310261    test-auc:0.743395+0.0116618</code></pre><pre class="line-numbers language-python"><code class="language-python">n_best_trees <span class="token operator">=</span> cv_results<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token keyword">print</span> <span class="token string">"best number of trees: {}"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>n_best_trees<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>best number of trees: 53</code></pre><pre class="line-numbers language-python"><code class="language-python">watchlist <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span>train_matrix<span class="token punctuation">,</span> <span class="token string">'train'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
gbt <span class="token operator">=</span> xgb<span class="token punctuation">.</span>train<span class="token punctuation">(</span>params<span class="token punctuation">,</span> train_matrix<span class="token punctuation">,</span> n_best_trees<span class="token punctuation">,</span>watchlist<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>[0]    train-auc:0.702188
[1]    train-auc:0.704781
[2]    train-auc:0.71018
[3]    train-auc:0.714805
[4]    train-auc:0.715547
[5]    train-auc:0.726005
[6]    train-auc:0.725821
[7]    train-auc:0.725022
[8]    train-auc:0.7335
[9]    train-auc:0.735223
[10]    train-auc:0.736723
[11]    train-auc:0.74205
[12]    train-auc:0.742289
[13]    train-auc:0.742862
[14]    train-auc:0.743885
[15]    train-auc:0.743699
[16]    train-auc:0.742109
[17]    train-auc:0.744295
[18]    train-auc:0.746087
[19]    train-auc:0.74534
[20]    train-auc:0.743896
[21]    train-auc:0.74842
[22]    train-auc:0.7502
[23]    train-auc:0.750863
[24]    train-auc:0.750096
[25]    train-auc:0.752116
[26]    train-auc:0.752202
[27]    train-auc:0.752974
[28]    train-auc:0.752529
[29]    train-auc:0.752424
[30]    train-auc:0.753932
[31]    train-auc:0.753449
[32]    train-auc:0.754669
[33]    train-auc:0.755053
[34]    train-auc:0.755589
[35]    train-auc:0.755971
[36]    train-auc:0.757188
[37]    train-auc:0.757529
[38]    train-auc:0.757631
[39]    train-auc:0.757584
[40]    train-auc:0.757568
[41]    train-auc:0.758382
[42]    train-auc:0.758155
[43]    train-auc:0.758213
[44]    train-auc:0.758067
[45]    train-auc:0.7586
[46]    train-auc:0.758911
[47]    train-auc:0.759027
[48]    train-auc:0.759092
[49]    train-auc:0.759198
[50]    train-auc:0.759484
[51]    train-auc:0.759869
[52]    train-auc:0.760239</code></pre><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># plot feature importances</span>
xgb<span class="token punctuation">.</span>plot_importance<span class="token punctuation">(</span>gbt<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x11ffb4e90&gt;</code></pre><p><img src="output_55_1.png" alt="png"></p>
<p>above feature importance match the result from <a href="#Explore-the-data">explorary analysis</a>.</p>
<h3 id="Plot-ROC-curve-and-choose-better-probability-threshold"><a href="#Plot-ROC-curve-and-choose-better-probability-threshold" class="headerlink" title="Plot ROC curve and choose better probability threshold"></a>Plot ROC curve and choose better probability threshold</h3><p><span style="color:orange;font-size:1.5em">since the data is highly imbalanced (positive examples is only 2% of the total examples), if using default probability threshold (0.5), the model just classify every example as negative, so we need to plot the ROC curve and choose a better probability threshold.</span></p>
<p><span style="color:red;font-weight:bold">But ROC cannot be plot on either training set or test set. </span>so I split the original train set into ‘training’ and ‘validation’ sets, <span style="color:orange;font-weight:bold">re-train on ‘training set’ and plot ROC on ‘validation set’. </span></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">print</span> <span class="token string">"n_best_trees={},xgboost parameters: "</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>n_best_trees<span class="token punctuation">)</span>
params<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>n_best_trees=53,xgboost parameters: 





{&#39;colsample_bytree&#39;: 0.8,
 &#39;early_stopping_rounds&#39;: 30,
 &#39;eta&#39;: 0.1,
 &#39;eval_metric&#39;: &#39;auc&#39;,
 &#39;max_depth&#39;: 6,
 &#39;num_rounds&#39;: 300,
 &#39;objective&#39;: &#39;binary:logistic&#39;,
 &#39;subsample&#39;: 0.8}</code></pre><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># define a function, avoid pollute the current namespace</span>
<span class="token keyword">def</span> <span class="token function">validation_roc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    Xtrain_only<span class="token punctuation">,</span>Xvalid<span class="token punctuation">,</span>ytrain_only<span class="token punctuation">,</span>yvalid <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>Xtrain<span class="token punctuation">,</span>ytrain<span class="token punctuation">,</span>test_size<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span>random_state<span class="token operator">=</span>seed<span class="token punctuation">)</span>

    train_only_matrix <span class="token operator">=</span> xgb<span class="token punctuation">.</span>DMatrix<span class="token punctuation">(</span>Xtrain_only<span class="token punctuation">,</span>ytrain_only<span class="token punctuation">)</span>
    valid_matrix <span class="token operator">=</span> xgb<span class="token punctuation">.</span>DMatrix<span class="token punctuation">(</span>Xvalid<span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true"># retrain on training set</span>
    gbt_train_only <span class="token operator">=</span> xgb<span class="token punctuation">.</span>train<span class="token punctuation">(</span>params<span class="token punctuation">,</span> train_only_matrix<span class="token punctuation">,</span> n_best_trees<span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true"># predict on validation set</span>
    yvalid_probas <span class="token operator">=</span> gbt_train_only<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>valid_matrix<span class="token punctuation">,</span> ntree_limit<span class="token operator">=</span>n_best_trees<span class="token punctuation">)</span>

    d <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    d<span class="token punctuation">[</span><span class="token string">'FPR'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>d<span class="token punctuation">[</span><span class="token string">'TPR'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>d<span class="token punctuation">[</span><span class="token string">'Threshold'</span><span class="token punctuation">]</span> <span class="token operator">=</span> roc_curve<span class="token punctuation">(</span>yvalid<span class="token punctuation">,</span>yvalid_probas<span class="token punctuation">)</span>
    <span class="token keyword">return</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>d<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python">roc_results <span class="token operator">=</span> validation_roc<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python">_ <span class="token operator">=</span> plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>roc_results<span class="token punctuation">.</span>FPR<span class="token punctuation">,</span>roc_results<span class="token punctuation">.</span>TPR<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">"FPR"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'TPR'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>&lt;matplotlib.text.Text at 0x11abea2d0&gt;</code></pre><p><img src="output_61_1.png" alt="png"></p>
<p>according to above ROC curve and make a compromise between Precision and Recall, <span style="color:orange;font-weight:bold;font-size:1.5em">I decide to choose a threshold which makes TPR at about 0.6, then FPR will be about 0.3, which I think is acceptable.</span></p>
<pre class="line-numbers language-python"><code class="language-python">roc_results<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">(</span>roc_results<span class="token punctuation">.</span>TPR <span class="token operator">></span> <span class="token number">0.6</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>roc_results<span class="token punctuation">.</span>TPR <span class="token operator">&lt;</span> <span class="token number">0.65</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>FPR</th>
      <th>TPR</th>
      <th>Threshold</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>192</th>
      <td>0.274192</td>
      <td>0.613861</td>
      <td>0.030303</td>
    </tr>
    <tr>
      <th>193</th>
      <td>0.274729</td>
      <td>0.613861</td>
      <td>0.030261</td>
    </tr>
    <tr>
      <th>194</th>
      <td>0.274960</td>
      <td>0.613861</td>
      <td>0.030247</td>
    </tr>
    <tr>
      <th>195</th>
      <td>0.284245</td>
      <td>0.617162</td>
      <td>0.030224</td>
    </tr>
    <tr>
      <th>196</th>
      <td>0.288389</td>
      <td>0.620462</td>
      <td>0.029755</td>
    </tr>
    <tr>
      <th>197</th>
      <td>0.288619</td>
      <td>0.620462</td>
      <td>0.029587</td>
    </tr>
    <tr>
      <th>198</th>
      <td>0.290998</td>
      <td>0.623762</td>
      <td>0.029482</td>
    </tr>
    <tr>
      <th>199</th>
      <td>0.291229</td>
      <td>0.623762</td>
      <td>0.029463</td>
    </tr>
    <tr>
      <th>200</th>
      <td>0.291996</td>
      <td>0.630363</td>
      <td>0.029195</td>
    </tr>
    <tr>
      <th>201</th>
      <td>0.292380</td>
      <td>0.630363</td>
      <td>0.029118</td>
    </tr>
    <tr>
      <th>202</th>
      <td>0.294298</td>
      <td>0.630363</td>
      <td>0.028849</td>
    </tr>
    <tr>
      <th>203</th>
      <td>0.295296</td>
      <td>0.630363</td>
      <td>0.028624</td>
    </tr>
    <tr>
      <th>204</th>
      <td>0.296217</td>
      <td>0.630363</td>
      <td>0.028613</td>
    </tr>
    <tr>
      <th>205</th>
      <td>0.302663</td>
      <td>0.630363</td>
      <td>0.028445</td>
    </tr>
    <tr>
      <th>206</th>
      <td>0.303661</td>
      <td>0.630363</td>
      <td>0.028363</td>
    </tr>
    <tr>
      <th>207</th>
      <td>0.303737</td>
      <td>0.630363</td>
      <td>0.028344</td>
    </tr>
    <tr>
      <th>208</th>
      <td>0.304044</td>
      <td>0.630363</td>
      <td>0.028225</td>
    </tr>
    <tr>
      <th>209</th>
      <td>0.313944</td>
      <td>0.643564</td>
      <td>0.028042</td>
    </tr>
    <tr>
      <th>210</th>
      <td>0.314020</td>
      <td>0.646865</td>
      <td>0.028016</td>
    </tr>
    <tr>
      <th>211</th>
      <td>0.315709</td>
      <td>0.646865</td>
      <td>0.027908</td>
    </tr>
    <tr>
      <th>212</th>
      <td>0.316016</td>
      <td>0.646865</td>
      <td>0.027625</td>
    </tr>
  </tbody>
</table>
</div>




<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># choose a threshold based on ROC</span>
<span class="token comment" spellcheck="true"># FPR=0.292380, TPR=0.630363, Threshold=0.029118</span>
pos_prob_threshold <span class="token operator">=</span> <span class="token number">0.029118</span>

<span class="token keyword">def</span> <span class="token function">adjust_predict</span><span class="token punctuation">(</span>matrix<span class="token punctuation">)</span><span class="token punctuation">:</span>
    y_probas <span class="token operator">=</span> gbt<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>matrix<span class="token punctuation">,</span> ntree_limit<span class="token operator">=</span>n_best_trees<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>y_probas <span class="token operator">></span> pos_prob_threshold<span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span>int<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python">ytrain_pred <span class="token operator">=</span> adjust_predict<span class="token punctuation">(</span>train_matrix<span class="token punctuation">)</span>
<span class="token keyword">print</span> classification_report<span class="token punctuation">(</span>ytrain<span class="token punctuation">,</span>ytrain_pred<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>             precision    recall  f1-score   support

          0       0.99      0.72      0.83     65265
          1       0.05      0.65      0.09      1402

avg / total       0.97      0.71      0.82     66667</code></pre><pre class="line-numbers language-python"><code class="language-python">ytest_pred <span class="token operator">=</span> adjust_predict<span class="token punctuation">(</span>test_matrix<span class="token punctuation">)</span>
<span class="token keyword">print</span> classification_report<span class="token punctuation">(</span>ytest<span class="token punctuation">,</span>ytest_pred<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>             precision    recall  f1-score   support

          0       0.99      0.71      0.83     32616
          1       0.04      0.60      0.08       717

avg / total       0.97      0.71      0.81     33333</code></pre><p><a id="test-precision-recall"></a>
<span style="color:orange;font-weight:bold;font-size:1.5em">more accurate Precision and Recall</span></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">print</span> <span class="token string">"test precision: {:.2f}%"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>precision_score<span class="token punctuation">(</span>ytest<span class="token punctuation">,</span>ytest_pred<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token string">"test recall: {:.2f}%"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>recall_score<span class="token punctuation">(</span>ytest<span class="token punctuation">,</span>ytest_pred<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>test precision: 4.35%
test recall: 60.11%</code></pre><pre class="line-numbers language-python"><code class="language-python">gbt<span class="token punctuation">.</span>save_model<span class="token punctuation">(</span><span class="token string">'gbt.model'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="Answer-question-2-and-question-3’s-first-part"><a href="#Answer-question-2-and-question-3’s-first-part" class="headerlink" title="Answer question 2 and question 3’s first part"></a>Answer question 2 and question 3’s first part</h2><ul>
<li><span style="color:blue;font-weight:bold">The VP of marketing thinks that it is stupid to send emails to a random subset and in a random way. Based on all the information you have about the emails that were sent, can you build a model to optimize in future email campaigns to maximize the probability of users clicking on the link inside the email?</span></li>
<li><span style="color:blue;font-weight:bold">By how much do you think your model would improve click through rate ( deﬁned as # of users who click on the link / total users who received the email). How would you test that?</span></li>
</ul>
<p>I have build a Gradient Boosting Tree model in previous section which predicts whether a user will click the link or not. Then the new email campaign strategy will be: <span style="color:orange;font-weight:bold;font-size:1.5em">only send email to users which my GBM model predicts positive.</span></p>
<pre class="line-numbers language-python"><code class="language-python">n_emails_old_sent <span class="token operator">=</span> ytest_pred<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
n_emails_new_sent <span class="token operator">=</span> ytest_pred<span class="token punctuation">.</span>sum<span class="token punctuation">(</span><span class="token punctuation">)</span>
saving_percentage <span class="token operator">=</span> <span class="token number">100</span> <span class="token operator">-</span> n_emails_new_sent <span class="token operator">*</span> <span class="token number">100.0</span><span class="token operator">/</span>n_emails_old_sent
pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'#emails sent in old way'</span><span class="token punctuation">:</span> n_emails_old_sent<span class="token punctuation">,</span>
           <span class="token string">'#emails sent in new way'</span><span class="token punctuation">:</span> n_emails_new_sent<span class="token punctuation">,</span>
           <span class="token string">'saving percentage (%)'</span><span class="token punctuation">:</span> saving_percentage<span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>#emails sent in new way     9904.000000
#emails sent in old way    33333.000000
saving percentage (%)         70.287703
dtype: float64</code></pre><p>according to its <a href="#test-precision-recall">predictive result on test set</a> </p>
<ul>
<li><span style="color:orange;">my model only need to send 30% of the old email amount, saving 70% amount.</span></li>
<li><span style="color:orange;">my model will cover 60% of valued users which will click the link. </span></li>
<li><span style="color:orange;">4.35% of the receiver will open email and click the link. </span> compare with <a href="#Answer-question-1">old strategy</a>, whose click rate is <em><em> 2.12% </em></em>, <span style="color:red;">my new strategy can double the click rate</span>.</li>
</ul>
<h2 id="Answer-question-3’s-second-part"><a href="#Answer-question-3’s-second-part" class="headerlink" title="Answer question 3’s second part"></a>Answer question 3’s second part</h2><p><span style="color:blue;font-weight:bold">By how much do you think your model would improve click through rate ( deﬁned as # of users who click on the link / total users who received the email). How would you test that?</span></p>
<p>To test my conclusion, we need to perform a A/B test:</p>
<ol>
<li>randomly assign users to two groups, Control group and Experiment group.</li>
<li>in Control group, still use the old email-campaign strategy, i.e., just send emails to all users in Control group.</li>
<li>in Experiment group, use my model to predict whether the user will click the link or not. and only send emails to those users whose predictive result is positive.</li>
<li>then we preform a one-tail unpaired t-test to test whether Experiement group’s population proportion is higher than Control group’s population proportion.</li>
</ol>

            </div>
            <hr />

            

            <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">

<div id="article-share">
    
    <div class="social-share" data-disabled="qzone, qq, weibo, douban"></div>
    
</div>

<script src="/libs/share/js/social-share.min.js"></script>

            


        </div>
    </div>

    
    <link rel="stylesheet" href="/libs/gitalk/gitalk.css">
<link rel="stylesheet" href="/css/my-gitalk.css">

<div class="card gitalk-card" data-aos="fade-up">
    <div id="gitalk-container" class="card-content"></div>
</div>

<script src="/libs/gitalk/gitalk.min.js"></script>
<script>
    let gitalk = new Gitalk({
        clientID: 'c090019fe3f06f8ef15d',
        clientSecret: '9f220a5e71efc340544fce7ae397f63151db8747',
        repo: 'naixinzhang.github.io',
        owner: 'naixinzhang',
        admin: "naixinzhang",
        id: '2018/02/01/take-home-challenge/5-market-email/market-email/',
        distractionFreeMode: false  // Facebook-like distraction free mode
    });

    gitalk.render('gitalk-container');
</script>
    

    

    

    

    
    <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments input[type=text],
    #vcomments input[type=email],
    #vcomments input[type=url],
    #vcomments textarea {
        box-sizing: border-box;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #42b983;
        font-weight: 500;
        text-decoration: underline;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div id="vcomments" class="card-content"></div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<!-- <script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script> -->

<script>
    new Valine({
        el: '#vcomments',
        appId: '',
        appKey: '',
        notify: 'false' === 'true',
        verify: 'false' === 'true',
        visitor: 'false' === 'true',
        avatar: 'wavatar',
        pageSize: '10',
        lang: 'en',
        placeholder: '如果你没有GitHub账号，还可以在这里评论啦！'
    });
</script>

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fa fa-chevron-left"></i>&nbsp;Previous</div>
            <div class="card">
                <a href="/2019/09/23/ml/islr-notes/8.2bagging-random-forest-boosting/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/7.jpg" class="responsive-img" alt="ISLR_ch8.2 Bagging,Random_Forest,Boosting">
                        
                        <span class="card-title">ISLR_ch8.2 Bagging,Random_Forest,Boosting</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            ISLR_ch8.2 Bagging,Random_Forest,BoostingBaggingBootstrap aggregation, or bagging, is a general-purpose procedure for re
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="fa fa-clock-o fa-fw icon-date"></i>2019-09-23
                        </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/An-Introduction-to-statistical-Learning/" class="post-category" target="_blank">
                                    An Introduction to statistical Learning
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Machine-Learning-notes/" target="_blank">
                        <span class="chip bg-color">Machine Learning notes</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                Next&nbsp;<i class="fa fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2018/01/31/take-home-challenge/6-price-test/price-test/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/8.jpg" class="responsive-img" alt="6-Price Test">
                        
                        <span class="card-title">6-Price Test</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            Background:
This notebook aims to evaluate whether a pricing test running on the site has been successful.
Specifically,
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="fa fa-clock-o fa-fw icon-date"></i>2018-01-31
                            </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Take-home-data-challenge/" class="post-category" target="_blank">
                                    Take home data challenge
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Python-Take-home-challenge/" target="_blank">
                        <span class="chip bg-color">Python_Take home challenge</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>
</div>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="fa fa-list-alt"></i>&nbsp;&nbsp;TOC</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fa fa-list"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            // headingsOffset: -205,
            headingSelector: 'h1, h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).slideUp(500);
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).slideDown(500);
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>
    

</main>


    <footer class="page-footer bg-color center-align">
    <div class="container row center-align">
        <div class="col s12 m8 l8 copy-right">
            &copy; 2020 NaixinZhang. All Rights Reserved.
        </div>
    </div>
</footer>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fa fa-search"></i>&nbsp;&nbsp;Search</span>
            <input type="search" id="searchInput" name="s" placeholder="Please enter a search keyword"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/" + "search.xml", 'searchInput', 'searchResult');
});
</script>
    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fa fa-angle-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <script type="text/javascript"> var OriginTitile = document.title, st; document.addEventListener("visibilitychange", function () { document.hidden ? (document.title = "Σ(っ °Д °;)っ喔哟，崩溃啦！", clearTimeout(st)) : (document.title = "φ(゜▽゜*)♪咦，又好了！", st = setTimeout(function () { document.title = OriginTitile }, 3e3)) })
    </script>

    <!-- Global site tag (gtag.js) - Google Analytics -->

<script async src="https://www.googletagmanager.com/gtag/js?id="></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());
    gtag('config', '');
</script>



    
    <script src="/libs/others/clicklove.js"></script>
    

    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    <!-- 雪花特效 -->
    

</body>

</html>